/*! ocr-hin.poc.v1.js */(function(){function r(e){'complete'===document.readyState?e():addEventListener('load',e,{once:!0})}async function o(){if(window.Tesseract)return window.Tesseract;return new Promise((e,t)=>{const n=document.createElement('script');n.src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js',n.onload=()=>e(window.Tesseract),n.onerror=()=>t(new Error('Falha a carregar Tesseract')),document.head.appendChild(n)})}function a(e){e=(e||'').toUpperCase().replace(/[^A-Z0-9-]/g,'');const t=[];e.length<14&&t.push('Muito curto');const n=e[10];n&&'ABCDEFGHIJKL'.indexOf(n)<0&&t.push('Mês inválido (A–L)');const r=e.slice(5,10);/[IOQ]/.test(r)&&t.push('Serial contém I/O/Q');const o=e.slice(12,14);return/^[0-9]{2}$/.test(o)&&((n=2000+Number(o))>=30&&(n-=100),n<1998&&t.push('<1998 carece certificado')),{clean:e,errs:t}}r(()=>{const e=document.getElementById('hinOcrBtn'),t=document.getElementById('winInput'),n=document.getElementById('winPhoto');e&&t&&n&&e.addEventListener('click',async()=>{try{n.files&&n.files[0]||(n.click(),await new Promise(e=>setTimeout(e,400)),n.files&&n.files[0]||0);const r=n.files[0],s=await o();e.disabled=!0,e.textContent='A ler...';const {data:{text:i}}=await s.recognize(r,'eng',{tessedit_char_whitelist:'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-'}),c=(i||'').replace(/\s+/g,'').toUpperCase(),d=c.match(/[A-Z]{2}-[A-Z]{3}[A-Z0-9]{2}[0-9]{5}-[A-L][0-9]-[0-9]{2}/),l=d?d[0]:c,{clean:u,errs:f}=a(l);t.value=u,f.length&&console.warn('[OCR-HIN] avisos:',f.join(' | ')),e.textContent='Ler Foto (OCR • beta)'}catch(s){e.textContent='Ler Foto (OCR • beta)',e.disabled=!1,alert('OCR falhou: '+(s.message||s))}finally{e.disabled=!1}})})})();