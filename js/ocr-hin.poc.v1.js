/*! ocr-hin.poc.v1.js */(function(){function e(n){document.readyState==='complete'?n():addEventListener('load',n,{once:true})}function t(){return{tessedit_char_whitelist:'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-'}}async function o(){if(window.Tesseract)return window.Tesseract;return new Promise((e,r)=>{const n=document.createElement('script');n.src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js',n.onload=()=>e(window.Tesseract),n.onerror=()=>r(new Error('Falha a carregar Tesseract')),document.head.appendChild(n)})}const r=/[A-Z]{2}-[A-Z]{3}[A-Z0-9]{2}[0-9]{5}-[A-L][0-9]-[0-9]{2}/;function a(e){const n=(e||'').toUpperCase().replace(/[^A-Z0-9-]/g,'');const t=[];n.length<14&&t.push('Muito curto');const o=n[10];o&&!'ABCDEFGHIJKL'.includes(o)&&t.push('Mês inválido (A–L)');const r$=n.slice(5,10);/[IOQ]/.test(r$)&&t.push('Serial contém I/O/Q');const a$=n.slice(12,14);if(/^\d{2}$/.test(a$)){let e=2000+Number(a$);Number(a$)>=30&&(e-=100),e<1998&&t.push('<1998 carece certificado')}return{clean:n,errs:t}}e(()=>{const e=document.getElementById('hinOcrBtn'),n=document.getElementById('winInput'),i=document.getElementById('winPhoto');if(!e||!n||!i)return;e.addEventListener('click',async()=>{try{if((!i.files||!i.files[0])&&(i.click(),await new Promise(e=>setTimeout(e,400)),!i.files||!i.files[0]))return;const s=await o();e.disabled=!0;const c=e.textContent;e.textContent='A ler…';const{data:{text:l}}=await s.recognize(i.files[0],'eng',t());const d=(l||'').replace(/\s+/g,'').toUpperCase();const u=d.match(r),m=u?u[0]:d;const{clean:h}=a(m);n.value=h,e.textContent=c,e.disabled=!1}catch(t){e.disabled=!1,alert('OCR falhou: '+(t.message||t))}})})})();