/*! auto-sync.patch.v1.js */(()=>{if(window.__MIEC_AUTOSYNC_PATCH__)return;window.__MIEC_AUTOSYNC_PATCH__=true;function o(n){document.readyState==='complete'?n():addEventListener('load',n,{once:true})}o(async function(){let t=0;while(!(window.MIEC_SYNC&&window.MIEC_SYNC.client)&&t<40){await new Promise(r=>setTimeout(r,250));t++;}const e=window.MIEC_SYNC?.client||window.supabaseClient;if(!e)return;try{const{data:{session:s}}=await e.auth.getSession();if(s&&window.HistoryService?.startAutoSync){HistoryService.startAutoSync();}e.auth.onAuthStateChange((_,c)=>{if(c&&window.HistoryService?.startAutoSync){HistoryService.startAutoSync();}});}catch(a){console.warn('[auto-sync] getSession failed:',a);}const i=window.HistoryService||{};if(typeof i.saveWin==='function'&&!i.__patched){const r=i.saveWin.bind(i),d=i.saveMotor?.bind(i);i.saveWin=u=>{const l=r(u);setTimeout(()=>window.MIEC_SYNC?.pushOutbox().catch(()=>{}),600);return l;};if(typeof d==='function'){i.saveMotor=u=>{const l=d(u);setTimeout(()=>window.MIEC_SYNC?.pushOutbox().catch(()=>{}),600);return l;};}i.__patched=true;}})})();